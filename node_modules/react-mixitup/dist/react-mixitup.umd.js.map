{"version":3,"file":"react-mixitup.umd.js","sources":["../src/utils.ts","../src/react-mixitup.tsx"],"sourcesContent":["import { IFrame, getKeysHash } from './react-mixitup';\n\nexport const createFrame = (keys: (string | number)[], index: number): IFrame => {\n  const nextHash = getKeysHash(keys);\n  return {\n    index,\n    hash: nextHash,\n    keys,\n    containerHeight: undefined,\n    containerWidth: undefined,\n    positions: {},\n    hasBeenMeasured: false\n  };\n};\n","import React from 'react';\nimport { createFrame } from './utils';\n\n/**\n * IPosition\n *\n * The position of a cell. x and y are its offsetX and offsetY position.\n * If a cell is to be removed or added the scale property will be added, 0 to 1\n */\ninterface IPosition {\n  x: number;\n  y: number;\n  scale?: number;\n}\n/**\n * IPositions\n *\n * The collection of positions for each key\n */\ninterface IPositions {\n  [key: string]: IPosition;\n}\n\n/**\n * StageType\n *\n * Determines what to render in the component\n */\nexport enum StageType {\n  /**\n   * STALE\n   *\n   * If the animation finishes the next stage will be STALE.\n   * Render the cells in the wrapper statically positioned.\n   */\n  STALE = 'STALE',\n  /**\n   * MEASURE\n   *\n   * If oldKeys.join() != nextKeys.join() then the next stage will be MEASURE.\n   *\n   * Render next cells in a hidden div and measure the position of each next cell.\n   * Measure the height of the next hidden wrapper.\n   *\n   * Measure the position of each old cell.\n   * Measure the height of the old wrapper.\n   */\n  MEASURE = 'MEASURE',\n  /**\n   * COMMIT\n   *\n   * If stage is MEASURE then the next stage will be COMMIT.\n   *\n   * Render all unique cells from the old list of keys and the next list of keys.\n   *\n   * All cells are position absolute. The old cells should be css translated to their old position and scaled to 1.\n   *\n   * All new cells, i.e those keys in next keys which are not in old keys should be translated to their\n   * next position, and scaled to 0.\n   */\n  COMMIT = 'COMMIT',\n  /**\n   * ANIMATE\n   *\n   * If stage is COMMIT or ANIMATE_COMMIT then the next stage will be ANIMATE.\n   *\n   * For each cell that should be moved, i.e the intersection between old keys and new keys, update style.translate to the new position.\n   *\n   * For each cell that should be removed, i.e those in old keys not present in new keys, update style.scale to 0\n   *\n   * For each cell that should be added, i.e. those in new keys not present in old keys, update style.cale to 1\n   */\n  ANIMATE = 'ANIMATE'\n  /**\n   * ANIMATE_MEASURE\n   *\n   * If stage is ANIMATE, and the keys are updated then the next stage will be ANIMATE_MEASURE.\n   *\n   * Render next cells in a hidden div and measure the position of each next cell.\n   * Measure the height of the next hidden wrapper.\n   *\n   * The positions of the old cells should already be measured\n   *\n   * Render the same as in ANIMATE while rendering the measuring component.\n   *\n   */\n  // replaced by MEASURE where stage.whileAnimating = true;\n  // ANIMATE_MEASURE = 'ANIMATE_MEASURE',\n  /**\n   * ANIMATE_COMMIT\n   *\n   * If stage is ANIMATE_MEASURE then the next stage will be ANIMATE_COMMIT.\n   *\n   * Render all unique cells from the old lists of keys (notice plural on lists) and the next list of keys.\n   * That is the the same as in ANIMATE.\n   *\n   * All cells which are now to be removed should be scaled to 0.\n   *\n   * All new cells, i.e those keys in next keys which are not in old keys should be translated to their\n   * next position, and scaled to 0.\n   */\n  // replaced by COMMIT where stage.whileAnimating = true;\n  // ANIMATE_COMMIT = 'ANIMATE_COMMIT'\n}\n\n/**\n * IFrame\n *\n * Holds information about the keys of rendered cells\n */\nexport interface IFrame {\n  /**\n   * The height of the container when all cells are rendered.\n   */\n  containerHeight: number | undefined;\n  /**\n   * The width of the container when all cells are rendered.\n   */\n  containerWidth: number | undefined;\n  /**\n   * The keys which should be rendered\n   */\n  keys: (string | number)[];\n  /**\n   * The positions of each cell\n   */\n  positions: IPositions;\n  /**\n   * A unique index used for debugging purposes to differentiate each IFrame\n   */\n  index: number;\n  /**\n   * If the frame has been measured\n   */\n  hasBeenMeasured: boolean;\n  /**\n   * a hash generated from the keys\n   */\n  hash: string;\n}\n\n/**\n * ICellStyle\n *\n * The styles passed to a renderCell\n */\nexport interface ICellStyle {\n  position?: 'absolute';\n  top?: string;\n  left?: string;\n  margin?: '0px';\n  transition?: string;\n  transform?: string;\n}\n\n/**\n * IWrapperStyle\n *\n * The styles passed to the renderWrapper\n */\nexport interface IWrapperStyle {\n  // position absolute in MEASURE stage and position relative in ANIMATE and COMMIT stage\n  // undefined in STALE stage\n  position?: 'absolute' | 'relative';\n  width?: number;\n  height?: number;\n  visibility?: 'hidden';\n  zIndex?: -1;\n}\n\n/**\n * IProps\n *\n * The props accepted by ReactMixitup\n */\ninterface IProps {\n  /**\n   * keys should be a unique list of strings.\n   */\n  keys: (string | number)[];\n  /**\n   * MUST return a react node.\n   *\n   * The item.key corresponds to a key in the keys prop.\n   * You should use the key to render the correct data in the cell.\n   *\n   * It MUST accept style and forward that to the returned component.\n   * Style contains the transition styles.\n   *\n   * The ref MUST also be attached to the returned element so\n   * ReactMixitup is able to measure the position of the cell.\n   */\n  renderCell: (\n    key: string | number,\n    style: ICellStyle,\n    ref: React.Ref<any>,\n    stage: StageType,\n    frame: IFrame,\n    activeFrame: boolean\n  ) => React.ReactNode | JSX.Element;\n\n  /**\n   * Optional, by default ReactMixitup will wrap all cells in a div.\n   *\n   * If provided renderWrapper MUST return a React node which accepts the provided style and ref.\n   *\n   * The ref is used to measure the height of the wrapping container.\n   *\n   * The style is used to update the height of the wrapping container.\n   * By setting the transition: height style property on the wrapper the height can be animated.\n   */\n  renderWrapper?: (\n    style: IWrapperStyle,\n    ref: React.Ref<any>,\n    cells: JSX.Element[],\n    stage: StageType,\n    frame: IFrame,\n    activeFrame: boolean\n  ) => React.ReactNode | JSX.Element;\n\n  /**\n   * Disable the transition\n   */\n  disableTransition?: boolean;\n\n  /**\n   * If the wrapper should grow/shrink vertically or horizontally when adding and removing cells\n   */\n  dynamicDirection: 'horizontal' | 'vertical' | 'off';\n\n  transitionDuration: number;\n\n  // default false. If true will remeasure all previous frames.\n  // only useful if resizing container while animation is slow and multiple animations are queued.\n  reMeasureAllPreviousFramesOnNewKeys?: boolean;\n\n  // default undefined. if number will render the measure container, and keep it for debugMeasure ms\n  // before removing\n  debugMeasure?: number;\n}\n\n/**\n * Creates a hash of the keys in order to determine if the keys are updated\n */\nexport function getKeysHash(keys: (string | number)[]): string {\n  return keys.map(k => `${(typeof k)[0]}${k}`).join(',');\n}\n\nexport enum DOMLevel {\n  ROOT = 'ROOT',\n  VISIBLE = 'VISIBLE',\n  WRAPPER = 'WRAPPER',\n  HIDDEN = 'HIDDEN'\n}\n\nexport const MixitupFragment = ({\n  children,\n  level\n}: {\n  children: React.ReactNode;\n  level: DOMLevel;\n}) => {\n  return <React.Fragment>{children}</React.Fragment>;\n};\n\n/**\n * MUST return a React node which accepts the provided style and ref.\n *\n * The ref is used to measure the height of the wrapping container.\n *\n * The style is used to update the height of the wrapping container.\n * By setting the transition: height style property on the wrapper the height can be animated.\n */\nexport type RenderWrapper = Exclude<IProps['renderWrapper'], undefined>;\n\n/**\n * MUST return a react node.\n *\n * The item.key corresponds to a key in the keys prop.\n * You should use the key to render the correct data in the cell.\n *\n * It MUST accept style and forward that to the returned component.\n * Style contains the transition styles.\n *\n * The ref MUST also be attached to the returned element so\n * ReactMixitup is able to measure the position of the cell.\n */\nexport type RenderCell = Exclude<IProps['renderCell'], undefined>;\n\n/**\n * Default renderer\n */\nconst defaultRenderWrapper: RenderWrapper = (style, ref, cells) => {\n  return (\n    <div style={style} ref={ref}>\n      {cells}\n    </div>\n  );\n};\n\nexport const TEST_COMPONENT_UPDATE_DELAY = 100;\n\ntype Stage =\n  | {\n      type: StageType.MEASURE;\n      frameToMeasure: IFrame;\n      whileAnimating: boolean;\n    }\n  | {\n      type: StageType.ANIMATE;\n    }\n  | {\n      type: StageType.COMMIT;\n      whileAnimating: boolean;\n    }\n  | {\n      type: StageType.STALE;\n      frame: IFrame;\n    };\n\nconst NotifyAboutRendered = ({\n  children,\n  frame\n}: {\n  children: React.ReactNode | JSX.Element;\n  frame: IFrame;\n}) => {\n  React.useLayoutEffect(() => {\n    frame.hasBeenMeasured = true;\n  }, [frame]);\n  return <>{children}</>;\n};\n\nconst processEnv = (name: string) => {\n  if (typeof process !== 'undefined' && process.env) {\n    return process.env[name];\n  }\n};\n\nconst debug = (...msg: any[]) => {\n  if (processEnv('DEBUG:react-mixitup')) {\n    console.log(...msg);\n  } else if (typeof window !== 'undefined' && window.localStorage) {\n    if (window.localStorage.getItem('DEBUG:react-mixitup')) {\n      console.log(...msg);\n    }\n  }\n};\n\nexport const ReactMixitup = React.memo(\n  React.forwardRef(\n    (props: IProps, outerBoundRef: React.Ref<HTMLDivElement>): JSX.Element | null => {\n      const {\n        keys,\n        renderCell,\n        renderWrapper = defaultRenderWrapper,\n        disableTransition: disableTransitionProp,\n        dynamicDirection,\n        transitionDuration\n      } = props;\n\n      const disableTransition = !!disableTransitionProp || transitionDuration === 0 || false;\n\n      if (!keys) {\n        throw new Error('Invalid keys: keys must be provided');\n      }\n\n      if (new Set(keys).size !== keys.length) {\n        throw new Error('Invalid keys: every key must be unique');\n      }\n\n      if (typeof transitionDuration !== 'number' || transitionDuration < 0) {\n        throw new Error('Invalid transitionDuration: transition duration must be a number > 0');\n      }\n\n      if (!renderCell || typeof renderCell !== 'function') {\n        throw new Error('Invalid renderCell: must be a function');\n      }\n\n      if (!renderWrapper || typeof renderWrapper !== 'function') {\n        throw new Error('Invalid renderWrapper: must be a function');\n      }\n\n      if (props.debugMeasure && typeof props.debugMeasure !== 'number') {\n        throw new Error('Invalid debugMeasure: must be a number');\n      }\n\n      const indexRef = React.useRef(0);\n\n      const nextHash = getKeysHash(keys);\n\n      const refs = React.useRef<{\n        frames: IFrame[];\n        persistedElement: JSX.Element | null;\n        hash: undefined | string;\n        stage: Stage;\n      }>(undefined as any);\n\n      if (!refs.current) {\n        const frame = createFrame(keys, indexRef.current++);\n        refs.current = {\n          frames: [frame],\n          persistedElement: null,\n          hash: undefined,\n          stage: { type: StageType.STALE, frame }\n        };\n      }\n\n      const [, _update] = React.useState(0);\n\n      const hasUnmounted = React.useRef(false);\n      React.useEffect(\n        () => () => {\n          hasUnmounted.current = true;\n        },\n        []\n      );\n\n      const update = () => {\n        setTimeout(\n          () => {\n            if (!hasUnmounted.current) {\n              _update(i => i + 1);\n            }\n          },\n          processEnv('NODE_ENV') === 'test' ? TEST_COMPONENT_UPDATE_DELAY : 1\n        );\n      };\n\n      function goToStale(frame: IFrame) {\n        debug('go to STALE');\n        refs.current.stage = {\n          type: StageType.STALE,\n          frame\n        };\n        // stale should always only have 1 frame\n        refs.current.frames = [frame];\n\n        update();\n      }\n\n      React.useEffect(() => {\n        const goToStaleOrNext = (cb: () => void) => {\n          if (!props.debugMeasure) {\n            cb();\n            return;\n          }\n\n          // only use case is when running with debugMeasure\n          // then you can update many times while in commit\n          // and end up at with the same keys as in the start\n          const lastFrame = refs.current.frames[refs.current.frames.length - 1];\n          if (refs.current.frames[0].hash === lastFrame.hash) {\n            debug('due to last frame being the same as first key we go straight back to STALE');\n            goToStale(lastFrame);\n          } else {\n            cb();\n          }\n        };\n        const goToAnimate = () => {\n          // from commit or measure\n          goToStaleOrNext(() => {\n            refs.current.stage = {\n              type: StageType.ANIMATE\n            };\n            if (processEnv('NODE_ENV') === 'test') {\n              setTimeout(() => {\n                update();\n              }, TEST_COMPONENT_UPDATE_DELAY);\n            } else {\n              window.requestAnimationFrame(() => {\n                update();\n              });\n            }\n          });\n        };\n        const goToCommit = (whileAnimating: boolean) => {\n          // from measure\n          goToStaleOrNext(() => {\n            refs.current.stage = {\n              type: StageType.COMMIT,\n              whileAnimating\n            };\n            update();\n          });\n        };\n        const maybeDelay = (cb: () => void) => {\n          if (props.debugMeasure) {\n            const t = setTimeout(() => {\n              cb();\n            }, props.debugMeasure);\n            return () => {\n              clearTimeout(t);\n            };\n          }\n          cb();\n        };\n        if (refs.current.stage.type === StageType.MEASURE) {\n          if (dynamicDirection === 'off') {\n            // skip COMMIT phase, go straight to ANIMATE\n            return maybeDelay(() => goToAnimate());\n          }\n          const whileAnimating = refs.current.stage.whileAnimating;\n          return maybeDelay(() => goToCommit(whileAnimating));\n        }\n\n        if (refs.current.stage.type === StageType.COMMIT) {\n          goToAnimate();\n        }\n      });\n\n      if (refs.current.hash === undefined) {\n        // first render\n        refs.current.hash = nextHash;\n      }\n\n      if (refs.current.hash !== nextHash) {\n        refs.current.hash = nextHash;\n        const frame = createFrame(keys, indexRef.current++);\n        if (disableTransition) {\n          refs.current.frames.splice(0, refs.current.frames.length, frame);\n          refs.current.stage = {\n            type: StageType.STALE,\n            frame\n          };\n        } else {\n          refs.current.frames.push(frame);\n          const whileAnimating =\n            'whileAnimating' in refs.current.stage\n              ? refs.current.stage.whileAnimating\n              : refs.current.stage.type === StageType.ANIMATE;\n          refs.current.stage = {\n            type: StageType.MEASURE,\n            frameToMeasure: frame,\n            whileAnimating\n          };\n        }\n      }\n\n      const measureGridItems = (frame: IFrame, key: string | number, el: HTMLElement) => {\n        const pos = {\n          x: el.offsetLeft,\n          y: el.offsetTop\n        };\n        frame.positions[key] = pos;\n      };\n\n      const wrapperMeasureContainerSize = (frame: IFrame, el: HTMLElement | null) => {\n        if (!el) {\n          return;\n        }\n        const h = el.offsetHeight;\n        const w = el.offsetWidth;\n        frame.containerHeight = h;\n        frame.containerWidth = w;\n      };\n\n      const cells = ({\n        ref,\n        style,\n        keys,\n        stageType,\n        activeFrame\n      }: {\n        keys: { key: string | number; frame: IFrame }[];\n        ref: (key: string | number, el: HTMLElement) => void;\n        style: (key: string | number) => ICellStyle;\n        stageType: StageType;\n        activeFrame: boolean;\n      }) => {\n        const makeRef = (key: string | number) => {\n          return (el: HTMLElement | null) => {\n            if (el) {\n              ref(key, el);\n            }\n          };\n        };\n\n        const cells = keys.map(({ key, frame }) => {\n          return (\n            <React.Fragment key={key}>\n              {renderCell(key, style(key), makeRef(key), stageType, frame, activeFrame)}\n            </React.Fragment>\n          );\n        });\n\n        return cells;\n      };\n\n      const measureFrame = (frame: IFrame, activeFrame: boolean) => (\n        <NotifyAboutRendered frame={frame}>\n          {renderWrapper(\n            props.debugMeasure\n              ? {\n                  position: 'absolute'\n                }\n              : {\n                  position: 'absolute',\n                  visibility: 'hidden',\n                  zIndex: -1\n                },\n            el => {\n              wrapperMeasureContainerSize(frame, el);\n            },\n            cells({\n              ref: (key, el) => {\n                measureGridItems(frame, key, el);\n              },\n              keys: frame.keys.map(key => ({ key, frame })),\n              style: staleStyle,\n              stageType: StageType.MEASURE,\n              activeFrame\n            }),\n            StageType.MEASURE,\n            frame,\n            activeFrame\n          )}\n        </NotifyAboutRendered>\n      );\n\n      const onEndOfTransition = () => {\n        const frame = refs.current.frames[refs.current.frames.length - 1];\n        debug('end of transition');\n        goToStale(frame);\n      };\n\n      React.useEffect(() => {\n        if (refs.current.stage.type === StageType.ANIMATE) {\n          debug('set timeout');\n          const timeout = setTimeout(() => {\n            onEndOfTransition();\n          }, transitionDuration);\n\n          return () => {\n            debug('clear timeout');\n            clearTimeout(timeout);\n          };\n        }\n      });\n\n      const staleStyle = (): ICellStyle => ({\n        transition: '0s 0s all ease',\n        transform: 'none'\n      });\n\n      debug('current stage', refs.current.stage.type);\n\n      // BEGIN RENDER\n\n      // The keys used on the React.Fragments are there to assist React in preseving the DOM tree nodes and\n      // prevent unmounting of components which interupts animation\n\n      // The hierarchies:\n      // root-level > visible-level > wrapper-level > renderWrapper\n      //      â†³     > hidden-level > [key] > wrapper-level > NotifyAboutRendered > renderWrapper\n\n      /**\n       * staleFrame\n       *\n       * Renders the cells without any modifications\n       *\n       * @param frame IFrame\n       * @returns React.ReactNode | JSX.Element\n       */\n      const staleFrame = (frame: IFrame) => (\n        <MixitupFragment key={DOMLevel.WRAPPER} level={DOMLevel.WRAPPER}>\n          {renderWrapper(\n            {},\n            () => {},\n            cells({\n              ref: () => {},\n              keys: frame.keys.map(key => ({ key, frame })),\n              style: staleStyle,\n              stageType: StageType.STALE,\n              activeFrame: true\n            }),\n            StageType.STALE,\n            frame,\n            true\n          )}\n        </MixitupFragment>\n      );\n\n      // If transitions are disabled, always render the staleFrame node\n      if (disableTransition) {\n        return (\n          <MixitupFragment key={DOMLevel.ROOT} level={DOMLevel.ROOT}>\n            <MixitupFragment key={DOMLevel.VISIBLE} level={DOMLevel.VISIBLE}>\n              {staleFrame(refs.current.frames[refs.current.frames.length - 1])}\n            </MixitupFragment>\n          </MixitupFragment>\n        );\n      }\n\n      /**\n       * getKeyFrameParticipation\n       *\n       * returns the frame indices where a key is present\n       *\n       * @param frames IFrame[]\n       * @param key string\n       * @returns number[]\n       */\n      const getKeyFrameParticipation = (frames: IFrame[], key: string | number): number[] => {\n        const indexes = [];\n        for (let i = frames.length - 1; i >= 0; i -= 1) {\n          const frame = frames[i];\n          if (frame.keys.includes(key)) {\n            indexes.push(i);\n          }\n        }\n        return indexes;\n      };\n\n      const animatedCellStyle = (\n        type: StageType.ANIMATE | StageType.COMMIT,\n        key: string | number,\n        frames: IFrame[]\n      ): ICellStyle => {\n        let z = 1;\n\n        const indexes = getKeyFrameParticipation(frames, key);\n        if (indexes.length === 0) {\n          throw new Error('something went wrong in the lib');\n        }\n\n        const { x: xTarget, y: yTarget } = frames[indexes[0]].positions[key];\n        const { x: xSource, y: ySource } = frames[indexes[indexes.length - 1]].positions[key];\n\n        const style: ICellStyle = {\n          position: 'absolute',\n          top: '0px',\n          left: '0px',\n          margin: '0px'\n        };\n\n        /* will be added */\n        // Last frame has the key.\n        // The key has not been added before.\n        // Type is commit\n        if (\n          frames[frames.length - 1].keys.includes(key) &&\n          indexes.length === 1 &&\n          type === StageType.COMMIT\n        ) {\n          // scale from 0 -> 1 when going from COMMIT -> ANIMATE\n          z = 0;\n        }\n\n        /* will be removed */\n        if (!frames[frames.length - 1].keys.includes(key)) {\n          // simply remove\n          z = 0;\n        }\n\n        const xDiff = xTarget - xSource;\n        const yDiff = yTarget - ySource;\n\n        style.left = xSource + 'px';\n        style.top = ySource + 'px';\n\n        if (type === StageType.COMMIT) {\n          style.transform = `translate3d(${[0, 0, 0].join('px,')}px) scale(${z})`;\n        } else {\n          style.transform = `translate3d(${[xDiff, yDiff, 0].join('px,')}px) scale(${z})`;\n        }\n        return style;\n      };\n\n      const getAllUniqueKeysForFrames = (frames: IFrame[]) => {\n        const keys: { frame: IFrame; key: string | number }[] = [];\n        const keysSet = new Set<string | number>();\n        frames.forEach(frame => {\n          frame.keys.forEach(key => {\n            if (keysSet.has(key)) {\n              return;\n            }\n            keysSet.add(key);\n            keys.push({ frame, key });\n          });\n        });\n        return keys;\n      };\n\n      /**\n       * animatingFrame\n       *\n       * Returns the nodes which renders while animating.\n       * Translate all elements to ther corresponding static location in the latest frame\n       *\n       * @param frames IFrame[]\n       * @returns JSX.Element\n       */\n      const animatingFrame = (frames: IFrame[]) => {\n        const lastFrame = frames[frames.length - 1];\n        const height = lastFrame.containerHeight!;\n        const width = lastFrame.containerWidth!;\n        const styles: IWrapperStyle = {\n          position: 'relative'\n        };\n        if (dynamicDirection === 'horizontal') {\n          styles.width = width;\n        } else if (dynamicDirection === 'vertical') {\n          styles.height = height;\n        }\n        const keys = getAllUniqueKeysForFrames(frames);\n        return (\n          <MixitupFragment key={DOMLevel.WRAPPER} level={DOMLevel.WRAPPER}>\n            {renderWrapper(\n              {\n                ...styles\n              },\n              () => {},\n              cells({\n                ref: (key, el) => {},\n                keys: keys,\n                style: key => {\n                  return animatedCellStyle(StageType.ANIMATE, key, frames);\n                },\n                stageType: StageType.ANIMATE,\n                activeFrame: true\n              }),\n              StageType.ANIMATE,\n              lastFrame,\n              true\n            )}\n          </MixitupFragment>\n        );\n      };\n\n      // When animating render the animatingFrame\n      if (refs.current.stage.type === StageType.ANIMATE) {\n        return (\n          <MixitupFragment key={DOMLevel.ROOT} level={DOMLevel.ROOT}>\n            <MixitupFragment key={DOMLevel.VISIBLE} level={DOMLevel.VISIBLE}>\n              {animatingFrame(refs.current.frames)}\n            </MixitupFragment>\n          </MixitupFragment>\n        );\n      }\n\n      // Commit will translate all elements to their corresponding static location of the previous frame.\n      if (refs.current.stage.type === StageType.COMMIT) {\n        const stage = refs.current.stage;\n        let sizeFrame = refs.current.frames[refs.current.frames.length - 2];\n        if (stage.whileAnimating) {\n          sizeFrame = refs.current.frames[refs.current.frames.length - 1];\n        }\n        const height = sizeFrame.containerHeight!;\n        const width = sizeFrame.containerWidth!;\n        const styles: IWrapperStyle = {\n          position: 'relative'\n        };\n        if (dynamicDirection === 'horizontal') {\n          styles.width = width;\n        } else if (dynamicDirection === 'vertical') {\n          styles.height = height;\n        }\n        const keys = getAllUniqueKeysForFrames(refs.current.frames);\n\n        return (\n          <MixitupFragment key={DOMLevel.ROOT} level={DOMLevel.ROOT}>\n            <MixitupFragment key={DOMLevel.VISIBLE} level={DOMLevel.VISIBLE}>\n              <MixitupFragment key={DOMLevel.WRAPPER} level={DOMLevel.WRAPPER}>\n                {renderWrapper(\n                  {\n                    ...styles\n                  },\n                  () => {},\n                  cells({\n                    ref: (key, el) => {},\n                    keys,\n                    style: key => {\n                      return animatedCellStyle(StageType.COMMIT, key, refs.current.frames);\n                    },\n                    stageType: StageType.COMMIT,\n                    activeFrame: true\n                  }),\n                  StageType.COMMIT,\n                  sizeFrame,\n                  true\n                )}\n              </MixitupFragment>\n            </MixitupFragment>\n          </MixitupFragment>\n        );\n      }\n\n      // Measure\n      if (refs.current.stage.type === StageType.MEASURE) {\n        const len = refs.current.frames.length;\n        const lastFrame = refs.current.frames[len - 1];\n        let measureFrames = refs.current.frames;\n        if (!props.reMeasureAllPreviousFramesOnNewKeys) {\n          measureFrames = [];\n          refs.current.frames.forEach((frame, index) => {\n            if (!frame.hasBeenMeasured) {\n              measureFrames.push(frame);\n            } else if (index >= len - 2) {\n              // push the last 2 frames\n              measureFrames.push(frame);\n            }\n          });\n        }\n        return (\n          <MixitupFragment key={DOMLevel.ROOT} level={DOMLevel.ROOT}>\n            <MixitupFragment key={DOMLevel.HIDDEN} level={DOMLevel.HIDDEN}>\n              {measureFrames.map((frame, index) => {\n                return (\n                  <React.Fragment key={frame.index}>\n                    {measureFrame(frame, index === measureFrames.length - 1)}\n                  </React.Fragment>\n                );\n              })}\n            </MixitupFragment>\n            <MixitupFragment key={DOMLevel.VISIBLE} level={DOMLevel.VISIBLE}>\n              {refs.current.stage.whileAnimating\n                ? animatingFrame(refs.current.frames.filter(frame => frame.hasBeenMeasured))\n                : staleFrame(refs.current.frames[0])}\n            </MixitupFragment>\n          </MixitupFragment>\n        );\n      }\n\n      // If stage is stale render the stale frame\n      if (refs.current.stage.type === StageType.STALE) {\n        return (\n          <MixitupFragment key={DOMLevel.ROOT} level={DOMLevel.ROOT}>\n            <MixitupFragment key={DOMLevel.VISIBLE} level={DOMLevel.VISIBLE}>\n              {staleFrame(refs.current.stage.frame)}\n            </MixitupFragment>\n          </MixitupFragment>\n        );\n      }\n\n      return null;\n    }\n  )\n);\n"],"names":["StageType","DOMLevel","React"],"mappings":"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"}